{% extends 'yuzzaz/besa.html'%}
{% load static %}
{% block location %}{{ product.name|truncatechars:15 }}{% endblock %}
{% block title %}{{ product.name }}{% endblock %}

{% block content %}
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
      <!-- Image Gallery -->
      <div class="space-y-6">
        <!-- Main Image Carousel -->
                <div class="relative overflow-hidden rounded-xl shadow-lg bg-white">
                    <div class="carousel-container relative h-80 md:h-96">
                        <!-- Slide 1 -->
                        <div
                            class="carousel-slide absolute inset-0 w-full h-full opacity-100 transition-opacity duration-500">
                            <img src="{{ room.image.url }}" alt="Property 1" class="w-full h-full object-cover">
                        </div>
                        <!-- Slide 2 -->
                        {% if room.image_2 %}
                        <div
                            class="carousel-slide absolute inset-0 w-full h-full opacity-0 transition-opacity duration-500">
                            <img src="{{ room.image_2.url }}" alt="Property 2" class="w-full h-full object-cover">
                        </div>
                        {% endif %}
                        {% if room.image_3 %}
                        <!-- Slide 3 -->
                        <div
                            class="carousel-slide absolute inset-0 w-full h-full opacity-0 transition-opacity duration-500">
                            <img src="{{ room.image_3.url }}" alt="Property 3" class="w-full h-full object-cover">
                        </div>
                        {% endif %}
                        {% if room.image_4 %}
                        <!-- Slide 4 -->
                        <div
                            class="carousel-slide absolute inset-0 w-full h-full opacity-0 transition-opacity duration-500">
                            <img src="{{ room.image_4.url }}" alt="Property 4" class="w-full h-full object-cover">
                        </div>
                        {% endif %}
                    </div>

                    <!-- Thumbnails -->
                    <div class="flex justify-center space-x-2 p-4 bg-gray-50">
                        <div class="thumbnail w-16 h-16 rounded-md overflow-hidden cursor-pointer border-2 border-transparent transition-all active"
                            data-index="0">
                            <img src="{{ room.image.url }}" alt="Thumb 1" class="w-full h-full object-cover">
                        </div>
                        {% if room.image_2 %}
                        <div class="thumbnail w-16 h-16 rounded-md overflow-hidden cursor-pointer border-2 border-transparent transition-all"
                            data-index="1">
                            <img src="{{ room.image_2.url }}" alt="Thumb 2" class="w-full h-full object-cover">
                        </div>
                        {% endif %}
                        {% if room.image_3 %}
                        <div class="thumbnail w-16 h-16 rounded-md overflow-hidden cursor-pointer border-2 border-transparent transition-all"
                            data-index="2">
                            <img src="{{ room.image_3.url }}" alt="Thumb 3" class="w-full h-full object-cover">
                        </div>
                        {% endif %}
                        {% if room.image_4 %}
                        <div class="thumbnail w-16 h-16 rounded-md overflow-hidden cursor-pointer border-2 border-transparent transition-all"
                            data-index="3">
                            <img src="{{ room.image_4.url }}" alt="Thumb 4" class="w-full h-full object-cover">
                        </div>
                        {% endif %}
                    </div>
                </div>
        
        <!-- Thumbnail Navigation -->
        <div class="grid grid-cols-4 gap-3">
          <div class="cursor-pointer border-2 border-transparent hover:border-black rounded-lg overflow-hidden transition-all">
            <img src="{{ product.image.url }}" alt="{{ product.name }}" 
                 class="w-full h-auto image-hover"
                 data-bs-target="#productCarousel" data-bs-slide-to="0">
          </div>
          {% if product.image_2 %}
          <div class="cursor-pointer border-2 border-transparent hover:border-black rounded-lg overflow-hidden transition-all">
            <img src="{{ product.image_2.url }}" alt="{{ product.name }}" 
                 class="w-full h-auto image-hover"
                 data-bs-target="#productCarousel" data-bs-slide-to="1">
          </div>
          {% endif %}
          {% if product.image_3 %}
          <div class="cursor-pointer border-2 border-transparent hover:border-black rounded-lg overflow-hidden transition-all">
            <img src="{{ product.image_3.url }}" alt="{{ product.name }}" 
                 class="w-full h-auto image-hover"
                 data-bs-target="#productCarousel" data-bs-slide-to="2">
          </div>
          {% endif %}
          {% if product.image_4 %}
          <div class="cursor-pointer border-2 border-transparent hover:border-black rounded-lg overflow-hidden transition-all">
            <img src="{{ product.image_4.url }}" alt="{{ product.name }}" 
                 class="w-full h-auto image-hover"
                 data-bs-target="#productCarousel" data-bs-slide-to="3">
          </div>
          {% endif %}
        </div>
      </div>
      
      <!-- Product Info -->
      <div class="space-y-6">
        <div class="border-b border-gray-200 pb-6">
          <h1 class="text-3xl font-bold tracking-tight">{{ product.name }}</h1>
          <p class="text-2xl mt-2 font-medium">{{ product.price|floatformat:2 }} TZS</p>
          
          {% if not product.status == 'sold_out' %}
          <div class="mt-3 flex items-center text-green-600">
            <i class="fas fa-check-circle mr-2"></i>
            <span>In Stock - Ready to Ship</span>
          </div>
          {% endif %}
        </div>
        
        <!-- Order Timeline -->
        <div class="flex justify-between items-center text-center py-4 border-b border-gray-200">
          <div class="flex flex-col items-center">
            <div class="w-10 h-10 rounded-full bg-black text-white flex items-center justify-center mb-2">
              <i class="fas fa-shopping-cart"></i>
            </div>
            <p class="text-sm font-medium">Order</p>
            <p class="text-xs text-gray-500">Today</p>
          </div>
          
          <div class="flex-1 border-t-2 border-dashed border-gray-300 mx-2"></div>
          
          <div class="flex flex-col items-center">
            <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center mb-2">
              <i class="fas fa-box"></i>
            </div>
            <p class="text-sm font-medium">Ready</p>
            <p class="text-xs text-gray-500">{{ ordered_date|date:"M d" }}</p>
          </div>
          
          <div class="flex-1 border-t-2 border-dashed border-gray-300 mx-2"></div>
          
          <div class="flex flex-col items-center">
            <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center mb-2">
              <i class="fas fa-truck"></i>
            </div>
            <p class="text-sm font-medium">Delivered</p>
            <p class="text-xs text-gray-500">{{ delivered_date|date:"M d" }}</p>
          </div>
        </div>
        
        <!-- Size Selection -->
        <div class="space-y-3">
          <h3 class="text-sm font-medium">Available Sizes</h3>
          <div class="flex flex-wrap gap-2">
            {% if product.size_s %}
            <button type="button" class="px-4 py-2 border border-black rounded-md hover:bg-black hover:text-white transition-colors">
              S
            </button>
            {% endif %}
            {% if product.size_m %}
            <button type="button" class="px-4 py-2 border border-black rounded-md hover:bg-black hover:text-white transition-colors">
              M
            </button>
            {% endif %}
            {% if product.size_l %}
            <button type="button" class="px-4 py-2 border border-black rounded-md hover:bg-black hover:text-white transition-colors">
              L
            </button>
            {% endif %}
            {% if product.size_xl %}
            <button type="button" class="px-4 py-2 border border-black rounded-md hover:bg-black hover:text-white transition-colors">
              XL
            </button>
            {% endif %}
            {% if product.size_xxl %}
            <button type="button" class="px-4 py-2 border border-black rounded-md hover:bg-black hover:text-white transition-colors">
              XXL
            </button>
            {% endif %}
          </div>
        </div>
        
        <!-- Add to Cart Button -->
        <div class="pt-4">
          <button onclick="location.href='{% if user.is_authenticated %}{% url 'add_to_cart' product.id %}{% else %}{% url 'login' %}?next={% url 'checkout' %}{% endif %}';"
                  class="w-full bg-black text-white py-3 px-4 rounded-md font-medium hover:bg-gray-800 transition-colors flex items-center justify-center {% if product.status == 'sold_out' %}opacity-50 cursor-not-allowed{% endif %}"
                  {% if product.status == 'sold_out' %}disabled{% endif %}>
            {% if product.status == 'sold_out' %}
              SOLD OUT
            {% else %}
              {% if user.is_authenticated %}
                <i class="fas fa-shopping-bag mr-2"></i> ADD TO CART
              {% else %}
                <i class="fas fa-sign-in-alt mr-2"></i> LOGIN TO ORDER
              {% endif %}
            {% endif %}
          </button>
          
          <a href="{% url 'homepage' %}" class="mt-3 inline-flex items-center text-sm text-gray-600 hover:text-black">
            <i class="fas fa-arrow-left mr-1"></i> Back to Collection
          </a>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Related Products -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 border-t border-gray-200">
    <h3 class="text-2xl font-bold mb-8">You May Also Like</h3>
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 md:gap-4 lg:gap-6">
        {% for product in random_products %}
        <div class="card-hover group relative overflow-hidden rounded-lg border border-gray-200 animate-fade-in">
          {% if product.status == 'sold_out' %}
            <div class="absolute top-2 right-2 bg-black text-white px-2 py-1 text-xs font-bold uppercase z-10">
              SOLD OUT
            </div>
          {% endif %}
          
          <a href="{% url 'product_detail' product.id %}" class="block">
          <div class="aspect-square overflow-hidden bg-gray-100">
            <img src="{{ product.image.url }}" alt="{{ product.name }}" 
                 class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">
          </div>
          
          <div class="p-4 text-center">
              <h3 class="font-medium text-base mb-1 group-hover:underline">{{ product.name }}</h3>
            </a>
            <p class="text-gray-800 font-medium text-sm">TZS {{ product.price }}</p>
          </div>
        </div>
        {% empty %}
        <div class="col-span-full text-center py-12">
          <div class="max-w-md mx-auto">
            <i class="fas fa-box-open text-5xl mb-4 opacity-50"></i>
            <h3 class="text-xl font-bold mb-2">Something Amazing is Coming</h3>
            <p class="opacity-75">Stay tuned for our next drop</p>
          </div>
        </div>
        {% endfor %}
      </div>
  </div>

  <script>
    // Initialize carousel and thumbnail interactions
    document.addEventListener("DOMContentLoaded", function() {
      const carousel = new bootstrap.Carousel(document.getElementById('productCarousel'));
      
      // Thumbnail click handlers
      document.querySelectorAll('[data-bs-slide-to]').forEach(thumb => {
        thumb.addEventListener('click', function() {
          const slideTo = parseInt(this.getAttribute('data-bs-slide-to'));
          carousel.to(slideTo);
        });
      });
      
      // Update active thumbnail when slide changes
      document.getElementById('productCarousel').addEventListener('slid.bs.carousel', function() {
        const activeIndex = document.querySelector('#productCarousel .carousel-item.active').index();
        document.querySelectorAll('[data-bs-slide-to]').forEach((thumb, index) => {
          if(index === activeIndex) {
            thumb.parentElement.classList.add('border-black');
            thumb.parentElement.classList.remove('border-transparent');
          } else {
            thumb.parentElement.classList.add('border-transparent');
            thumb.parentElement.classList.remove('border-black');
          }
        });
      });
    });
  </script>
{% endblock %}